---
title: "FinalExam-Nev-Simmons.R"
author: "Simmons, Nev"
date: "2024-12-08"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) #Eliminates errors and long messages
```

```{r}
library(tidyverse)
library(caret)
library(knitr)
```

#Part 1

```{r}
diabetesdata <- read_csv("diabetes_data.csv")

diabetesdata <- diabetesdata %>%
  mutate(diabetes = as.factor(diabetes),
         gender = as.factor(gender),
         hypertension = as.factor(hypertension),
         heart_disease = as.factor(heart_disease),
         smoking_history = as.factor(smoking_history))
```

```{r}
set.seed(1211)
DiabetesIndex <- createDataPartition(1:nrow(diabetesdata), p=0.80)$Resample1

diabetes_train <- filter(diabetesdata, row_number() %in% DiabetesIndex)
diabetes_test <- filter(diabetesdata, !row_number() %in% DiabetesIndex)

train_control <- trainControl(method = "repeatedcv", number = 5, repeats=10)
```

```{r, cache=TRUE}
set.seed(1211)
diabetes.log <- train(diabetes ~ gender + age + hypertension + heart_disease + 
                       smoking_history + bmi + HbA1c_level + blood_glucose_level,
                data=diabetes_train, 
                method="glm",
                family = "binomial",
                trControl=train_control)
```


```{r singleTree, cache=TRUE}
set.seed(1211)
diabetes.tree <- train(diabetes ~ HbA1c_level + age + blood_glucose_level + bmi,
                data=diabetes_train,
                method="rpart",
                trControl=train_control,
                tuneLength=5)
```

```{r randomForest, cache=TRUE}
set.seed(1211)
diabetes.rf <- train(diabetes ~ gender + age + hypertension + heart_disease + 
                       smoking_history + bmi + HbA1c_level + blood_glucose_level, 
                data=diabetes_train,
                method="rf",
                trControl=train_control,
                tuneGrid=expand.grid(mtry=1:4),
                ntree = 500,
                importance=TRUE)
```

```{r}
variableimp <- varImp(diabetes.rf$finalModel)
variableimp
```
Based on the variable importance of the random forest model, the HbA1c level seems to be the most important predictor of diabetes with a score of 91.94. Blood glucose level seems to be the next highest predictor of diabetes with a score of 58.7.
The next three highest variables are age with a score of 41.06, positive for hypertension or high blood pressure with 18.51 and lastly positive for heart disease with 13.56. As far as the models are concerned, I chose a logistic regression to get a relatively simple model to predict every variable. This gave me a good baseline as it is the least complex model chosen. Next I chose a single regression tree to get a little more complex but this time only test a small subset of variables. For the variables chosen I picked variables I would think would have the most importance in determining diabetes based on information learned in biology and prior knowledge of diabetes. Finally I took the most complex route of random forest to discover the variable importance as well as get a final baseline using the most complex prediction. I chose all predictors to understand the importance of every single predictor rather than just a small subset. 

# Part 2

```{r}
models.summary <- resamples(list(Logistic= diabetes.log,
                         SingleTree = diabetes.tree,
                         RandomForest= diabetes.rf))
summary(models.summary)

```
```{r}
ggplot(models, metric="RMSE") +
  labs(title = "RMSE Values of Each Model",
       x = "RMSE") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
        axis.title = element_text(size = 11),
        plot.caption = element_text(hjust = 0.5, size = 9))
```

```{r}
ggplot(diabetesdata) +
  geom_boxplot(aes(x= HbA1c_level, y = diabetes)) + 
  labs(title = "HbA1c Level as a Predictor For Diabetes",
       x = "HbA1C Level", 
       y = "Test Result for Diabetes") +
  scale_y_discrete(breaks = c("0", "1"),
                   labels = c("Negative", "Positive")) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
        axis.title = element_text(size = 11),
        plot.caption = element_text(hjust = 0.5, size = 9),
        panel.grid.major.x = element_blank(),   #Get rid of horizontal lines
        panel.grid.minor = element_blank()) 
```

```{r}
ggplot(diabetesdata) +
  geom_boxplot(aes(x= blood_glucose_level, y = diabetes)) + 
  labs(title = "Blood Glucose Level as a Predictor For Diabetes",
       x = "Blood Glucose Level", 
       y = "Test Result for Diabetes") +
  scale_y_discrete(breaks = c("0", "1"),
                   labels = c("Negative", "Positive")) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
        axis.title = element_text(size = 11),
        plot.caption = element_text(hjust = 0.5, size = 9),
        panel.grid.major.x = element_blank(),   #Get rid of horizontal lines
        panel.grid.minor = element_blank()) 
```

```{r}
ggplot(diabetesdata) +
  geom_histogram(aes(x = diabetes, fill = HbA1c_level), color = "gray60", bins = 20) +
  theme(legend.position = "none")
```

